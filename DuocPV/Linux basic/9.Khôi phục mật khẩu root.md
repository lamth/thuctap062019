# Khôi phục mật khẩu root # 
## Sử dụng với Centos 7 ## 
- Khi bạn không nhớ mật khẩu root , chúng ta có thể khôi phục mật khẩu bị mất của một **superuser(root)** bằng các bước dưới đây. 
- ![Atom](https://i.imgur.com/14y7IKA.png) 

- Trong munu grub khởi động, chọn tùy chọn để chỉnh sửa dòng thứ 2 
- ![Atom](https://i.imgur.com/3EDDrKH.png) 

- Chọn tùy chọn để chỉnh sửa **(e)** 
- ![Atom](https://i.imgur.com/w2YaPTS.png) 

- Chuyển đến dòng `linux16...` và thay đổi `ro` thành `rw init=/sysroot/bin/bash`
- ![Atom](https://i.imgur.com/r4L7qwB.png) 

- Bây giờ nhấn **Control + x** để bắt đầu ở chế độ người dùng . 
- ![Atom](https://i.imgur.com/G8bIXEp.png) 

- Trong chế độ người dùng, chúng ta sẽ thay đổi mật khẩu gốc. Đầu tiên chúng ta chạy lệnh như bên dưới 
```
chroot /sysroot
```

- Tiếp theo chúng ta sẽ chạy các lệnh dưới đây để thay đổi mật khẩu cho **superuser(root)**
```
passwd root
```

- Chúng ta sẽ nhắc tạo và xác nhận mật khẩu mới. Sau khi tạo mật khẩu, chạy lệnh bên dưới để truy cập nhật các tham số **SElinux**
```
touch /.autorelabel
```

- Thoát và khởi động lại hệ thống của bạn như sau :
```
exit
reboot
```

- **Lưu ý**: Nếu hệ thống có đang dùng SElinux thì chúng ta mới thực hiện thêm các bước SElinux.
- Các thao tác trên được thực hiện như hình dưới: 
- ![Atom](https://i.imgur.com/k1BuKce.png)

- Sau khi reset password cho superuser(root) thành công bạn có thể đăng nhập và sử dụng hệ thống với mật khẩu mới mà bạn đã tạo.

## Chỉnh sửa password trong file
- Trên Ubunu hay Centos thì carcklib được cài đặt sẵn, vì vậy không cần cài đặt thêm là cần thiết trên hệ thống. Để thực thi chính sách mật khẩu, chúng ta cần phải sửa đổi một tập tin cấu hình PAM xác thực liên quan đến /etc/pam.d
```
sudo apt-get install libpam-carcklib
```
###1. Đặt mật khẩu ngắn nhất 
- Thêm **minlen=10** 
- Trên ubuntu
```
sudo vi /etc/pam.d/common-password
password    requisite    pam_cracklib.so retry=3 minlen=10 difok=3
```
- Trên Centos
```
sudo vi /etc/pam.d/system-auth
password   requisite   pam_cracklib.so retry=3 diofok=3 minlen=10
```
### 2. không dùng lại pass cũ 
- Trên ubuntu
```
sudo vi /etc/pam.d/common-password
password     [success=1 default=ignore]   pam_unix.so obscure sha512 remember=5
```
- Trên Centos
```
sudo vi /etc/pam.d/system-auth
password    sufficient  pam_unix.so sha512 shadow nullok try_pass use _authtok remember=5
```
### 3. Thiết lập độ phức tạp cho password
- trên Ubunu
```
sudo vi /etc/pam.d/common-password
password   requisite    pam_cracklib.so retry=3 minlen=10 difok=3 ucredit=-1 lcredit=-2 dcredit=-1 ocredit=-1
```
- trên Centos
```
sudo vi /etc/pam.d/system-auth
password   requisite    pam_cracklib.so retry=3 minlen=10 difok=3 ucredit=-1 lcredit=-2 dcredit=-1 ocredit=-1
```
- password trên được hiểu là pass của bạn phải bắt buộc có ít nhất một chữ hoa(ucredit), 2 chữ thường(lcredit),một chữ số(dcredit) và một biểu tượng(ocredit)
